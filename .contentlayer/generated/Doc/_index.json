[
  {
    "title": "How do server actions work under the hood?",
    "description": "A deep dive into how server actions work in the background, and undelying mechanisms that make it possible.",
    "published": true,
    "author": "zackozack",
    "featured": true,
    "publishedAt": "2025-01-30T00:00:00.000Z",
    "updatedAt": "2025-02-01T00:00:00.000Z",
    "tags": [
      "react",
      "nextjs",
      "server-actions",
      "nextjs-server-actions"
    ],
    "body": {
      "raw": "\n## What is a Server Action?\n\nA Server Action is an asynchronous function executed on the server, designed for handling data mutations (e.g., form submissions, API calls) directly from React components, serve as a built-in remote procedure call (RPC) mechanism. It eliminates the need for separate API routes, enabling seamless integration of server-side logic with client-side interactions.\n\n<br />\n**Key features:**\n\n- **Progressive Enhancement:** Works even if JavaScript is disabled.\n- **Caching & Revalidation:** Integrates with Next.js caching (e.g., `revalidatePath`, `revalidateTag`).\n- **Security:** Uses encrypted IDs and CSRF protection by default.\n\n### How to Create a Server Action\n\nOne of the steps to create a server action is to create a file with `'use server'`. This tells Next.js to treat the file as a server action.\n\n```ts\n// app/actions.ts\n'use server';\nexport async function deletePost(postId: string) {\n  // Delete post from database\n  await db.post.delete({ where: { id: postId } });\n  revalidatePath('/posts'); // Update cache\n}\n```\n\nYou can then import and use it in your React client components.\n\n```tsx\n'use client';\nimport { deletePost } from '@/app/actions';\n\nexport function DeleteButton({ postId }: { postId: string }) {\n  return <button onClick={() => deletePost(postId)}>Delete</button>;\n}\n```\n\n## The Core Principle: Remote Procedure Calls (RPC)\n\n<img src=\"/images/server-actions-under-the-hood/server-action-flow.png\" alt=\"Server Action Flow\" />\n\nAt their core, Server Actions implement an RPC pattern using HTTP POST requests. When you write:\n\n```ts\n\"use server\";  \nexport async function createPost(data: FormData) {  \n  // Database interaction  \n}  \n\n```\n\nNext.js performs these critical operations:\n\n1. **Server-Side Registration**: During the build process, Next.js scans for functions marked with `\"use server\"`. Each such function is registered in an internal “action registry” with a unique action ID.\n2. **Client-side proxy generation**: Instead of sending the entire function code to the client, Next.js generates a lightweight client proxy. This proxy is merely a thin layer that, when called, packages the function’s arguments (after serialization) and triggers a `POST` request.\n3. **Security wrapping**: Adds automatic *CSRF protection* for requests. \n\n\nAnd finally, when the server action is invoked from the client like this:\n\n```tsx\n<form action={createPost}>  \n  <input name=\"content\" />  \n  <button>Submit</button>  \n</form>  \n```\nWhen the client invokes the proxy (e.g., from a button click or a form submission), the browser submits a POST request with the action ID and serialized headers, the whole process is as follows:\n\n<br/>\n**1. Serialization of function's arguments**: \n- FormData is encoded using [`multipart/form-data`](https://developer.mozilla.org/en-US/docs/Web/API/FormData)\n- Non-form invocations use JSON.stringify() with [SuperJSON](https://github.com/blitz-js/superjson) for rich type support\n\n**2. Request Dispatch**: \nThe proxy sends a POST request to a hidden endpoint with the action ID and serialized parameters.\n\n```bash\nPOST /createPost HTTP/1.1  \nContent-Type: multipart/form-data  \nX-Action: \"ACTION_ID\"  \nX-Forwarded-Host: example.com  \n...\n```\n**3. Server Processing**: The server intercepts the request, and:\n\n- Next.js runtime (or the server proxy) matches the `X-Action` header to registered functions.\n- Deserializes payload using inverse of client-side encoding.\n- Executes within isolated server context (no client dependencies).\n\n**4. Response Handling**:\n\n- The output is serialized and returned to the client.\n- The client proxy receives the response and continues execution as if it were a direct function call.\n\nThis remote procedure call (RPC) pattern means that—despite the illusion of a direct function call—every server action is performing a network round-trip over HTTP behind the scenes. The beauty of this abstraction is that it eliminates the need to manually create and maintain separate API endpoints for many common operations.\n\n### Security Architecture\nServer Actions implement enterprise-grade security by default:\n\n#### CSRF Protection\n- **Automatic CSRF tokens**: Each server action request includes a unique [CSRF token](https://brightsec.com/blog/csrf-token/) in the headers.\n- Signed double-submit cookies with `__Host-` prefix\n- Strict origin matching via `Sec-Fetch-Site` header validation\n\n#### Payload Validation\n- **Type safety**: TypeScript types are enforced on the server side.\n```ts\n// Next.js generates runtime validation from TypeScript types:  \nif (typeof data.content !== \"string\") {  \n  throw new ActionError(\"Invalid payload\");  \n}  \n```\n<Callout icon={<Icons.InfoIcon />} type='danger'>\n#### No runtime type safety\nAlways validate server action inputs with [`Zod`](https://zod.dev/), as TypeScript types alone don’t provide runtime safety.\n</Callout>\n\n#### Isolation Boundaries\n- **Server-side isolation**: Server actions run in a separate Node.js process, isolated from the client runtime.\n- Timeouts enforced via [`AsyncLocalStorage`](https://nodejs.org/api/async_context.html).\n\n\n### Conclusion\nServer Actions represent a fundamental shift in web architecture, enabling developers to build full-stack applications with minimal boilerplate. By abstracting away the complexities of network communication and security.",
      "code": "var Component=(()=>{var y=Object.create;var c=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var D=(l,e)=>()=>(e||l((e={exports:{}}).exports,e),e.exports),A=(l,e)=>{for(var r in e)c(l,r,{get:e[r],enumerable:!0})},a=(l,e,r,t)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let i of f(e))!g.call(l,i)&&i!==r&&c(l,i,{get:()=>e[i],enumerable:!(t=u(e,i))||t.enumerable});return l};var F=(l,e,r)=>(r=l!=null?y(m(l)):{},a(e||!l||!l.__esModule?c(r,\"default\",{value:l,enumerable:!0}):r,l)),C=l=>a(c({},\"__esModule\",{value:!0}),l);var d=D((S,s)=>{s.exports=_jsx_runtime});var b={};A(b,{default:()=>p,frontmatter:()=>B});var n=F(d()),B={title:\"How do server actions work under the hood?\",description:\"A deep dive into how server actions work in the background, and undelying mechanisms that make it possible.\",publishedAt:\"2025-01-30\",updatedAt:\"2025-02-01\",featured:!0,published:!0,author:\"zackozack\",tags:[\"react\",\"nextjs\",\"server-actions\",\"nextjs-server-actions\"]};function h(l){let e={a:\"a\",code:\"code\",em:\"em\",figure:\"figure\",h2:\"h2\",h3:\"h3\",h4:\"h4\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...l.components},{Callout:r,Icons:t}=e;return r||o(\"Callout\",!0),t||o(\"Icons\",!1),t.InfoIcon||o(\"Icons.InfoIcon\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"what-is-a-server-action\",children:[(0,n.jsx)(e.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#what-is-a-server-action\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"What is a Server Action?\"]}),`\n`,(0,n.jsx)(e.p,{children:\"A Server Action is an asynchronous function executed on the server, designed for handling data mutations (e.g., form submissions, API calls) directly from React components, serve as a built-in remote procedure call (RPC) mechanism. It eliminates the need for separate API routes, enabling seamless integration of server-side logic with client-side interactions.\"}),`\n`,(0,n.jsx)(\"br\",{}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Key features:\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Progressive Enhancement:\"}),\" Works even if JavaScript is disabled.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Caching & Revalidation:\"}),\" Integrates with Next.js caching (e.g., \",(0,n.jsx)(e.code,{children:\"revalidatePath\"}),\", \",(0,n.jsx)(e.code,{children:\"revalidateTag\"}),\").\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Security:\"}),\" Uses encrypted IDs and CSRF protection by default.\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.h3,{id:\"how-to-create-a-server-action\",children:[(0,n.jsx)(e.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#how-to-create-a-server-action\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"How to Create a Server Action\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"One of the steps to create a server action is to create a file with \",(0,n.jsx)(e.code,{children:\"'use server'\"}),\". This tells Next.js to treat the file as a server action.\"]}),`\n`,(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{style:{backgroundColor:\"#1e1e2e\",color:\"#cdd6f4\"},tabIndex:\"0\",\"data-language\":\"ts\",\"data-theme\":\"catppuccin-mocha\",children:(0,n.jsxs)(e.code,{\"data-language\":\"ts\",\"data-theme\":\"catppuccin-mocha\",style:{display:\"grid\"},children:[(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#6C7086\",fontStyle:\"italic\"},children:\"// app/actions.ts\"})}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#A6E3A1\"},children:\"'use server'\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\";\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\"export\"}),(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\" async\"}),(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\" function\"}),(0,n.jsx)(e.span,{style:{color:\"#89B4FA\",fontStyle:\"italic\"},children:\" deletePost\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#EBA0AC\",fontStyle:\"italic\"},children:\"postId\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\":\"}),(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\" string\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\")\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\" {\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#6C7086\",fontStyle:\"italic\"},children:\"  // Delete post from database\"})}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\"  await\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\" db\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"post\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#89B4FA\",fontStyle:\"italic\"},children:\"delete\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\"{\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\" where\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\":\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\" {\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\" id\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\":\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\" postId \"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\"}\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\" }\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\")\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\";\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#89B4FA\",fontStyle:\"italic\"},children:\"  revalidatePath\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#A6E3A1\"},children:\"'/posts'\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\")\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\";\"}),(0,n.jsx)(e.span,{style:{color:\"#6C7086\",fontStyle:\"italic\"},children:\" // Update cache\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\"}\"})})]})})}),`\n`,(0,n.jsx)(e.p,{children:\"You can then import and use it in your React client components.\"}),`\n`,(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{style:{backgroundColor:\"#1e1e2e\",color:\"#cdd6f4\"},tabIndex:\"0\",\"data-language\":\"tsx\",\"data-theme\":\"catppuccin-mocha\",children:(0,n.jsxs)(e.code,{\"data-language\":\"tsx\",\"data-theme\":\"catppuccin-mocha\",style:{display:\"grid\"},children:[(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#A6E3A1\"},children:\"'use client'\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\";\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\"import\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\" {\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\" deletePost \"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\"}\"}),(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\" from\"}),(0,n.jsx)(e.span,{style:{color:\"#A6E3A1\"},children:\" '@/app/actions'\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\";\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\"export\"}),(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\" function\"}),(0,n.jsx)(e.span,{style:{color:\"#89B4FA\",fontStyle:\"italic\"},children:\" DeleteButton\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\"({\"}),(0,n.jsx)(e.span,{style:{color:\"#EBA0AC\",fontStyle:\"italic\"},children:\" postId\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\" }\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\":\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\" {\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\",fontStyle:\"italic\"},children:\" postId\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\":\"}),(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\" string\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\" })\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\"  return\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\" <\"}),(0,n.jsx)(e.span,{style:{color:\"#89B4FA\"},children:\"button\"}),(0,n.jsx)(e.span,{style:{color:\"#F9E2AF\"},children:\" onClick\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\"{()\"}),(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\" =>\"}),(0,n.jsx)(e.span,{style:{color:\"#89B4FA\",fontStyle:\"italic\"},children:\" deletePost\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"(postId)\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\"}\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\">\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"Delete\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\"</\"}),(0,n.jsx)(e.span,{style:{color:\"#89B4FA\"},children:\"button\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\">\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\";\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\"}\"})})]})})}),`\n`,(0,n.jsxs)(e.h2,{id:\"the-core-principle-remote-procedure-calls-rpc\",children:[(0,n.jsx)(e.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#the-core-principle-remote-procedure-calls-rpc\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The Core Principle: Remote Procedure Calls (RPC)\"]}),`\n`,(0,n.jsx)(\"img\",{src:\"/images/server-actions-under-the-hood/server-action-flow.png\",alt:\"Server Action Flow\"}),`\n`,(0,n.jsx)(e.p,{children:\"At their core, Server Actions implement an RPC pattern using HTTP POST requests. When you write:\"}),`\n`,(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{style:{backgroundColor:\"#1e1e2e\",color:\"#cdd6f4\"},tabIndex:\"0\",\"data-language\":\"ts\",\"data-theme\":\"catppuccin-mocha\",children:(0,n.jsxs)(e.code,{\"data-language\":\"ts\",\"data-theme\":\"catppuccin-mocha\",style:{display:\"grid\"},children:[(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#A6E3A1\"},children:'\"use server\"'}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\";\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"  \"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\"export\"}),(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\" async\"}),(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\" function\"}),(0,n.jsx)(e.span,{style:{color:\"#89B4FA\",fontStyle:\"italic\"},children:\" createPost\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#EBA0AC\",fontStyle:\"italic\"},children:\"data\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\":\"}),(0,n.jsx)(e.span,{style:{color:\"#F9E2AF\",fontStyle:\"italic\"},children:\" FormData\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\")\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\" {\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"  \"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#6C7086\",fontStyle:\"italic\"},children:\"  // Database interaction  \"})}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\"}\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"  \"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:\" \"})]})})}),`\n`,(0,n.jsx)(e.p,{children:\"Next.js performs these critical operations:\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Server-Side Registration\"}),\": During the build process, Next.js scans for functions marked with \",(0,n.jsx)(e.code,{children:'\"use server\"'}),\". Each such function is registered in an internal \\u201Caction registry\\u201D with a unique action ID.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Client-side proxy generation\"}),\": Instead of sending the entire function code to the client, Next.js generates a lightweight client proxy. This proxy is merely a thin layer that, when called, packages the function\\u2019s arguments (after serialization) and triggers a \",(0,n.jsx)(e.code,{children:\"POST\"}),\" request.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Security wrapping\"}),\": Adds automatic \",(0,n.jsx)(e.em,{children:\"CSRF protection\"}),\" for requests.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"And finally, when the server action is invoked from the client like this:\"}),`\n`,(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{style:{backgroundColor:\"#1e1e2e\",color:\"#cdd6f4\"},tabIndex:\"0\",\"data-language\":\"tsx\",\"data-theme\":\"catppuccin-mocha\",children:(0,n.jsxs)(e.code,{\"data-language\":\"tsx\",\"data-theme\":\"catppuccin-mocha\",style:{display:\"grid\"},children:[(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\"<\"}),(0,n.jsx)(e.span,{style:{color:\"#89B4FA\"},children:\"form\"}),(0,n.jsx)(e.span,{style:{color:\"#F9E2AF\"},children:\" action\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\"{\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"createPost\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\"}\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\">\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"  \"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\"  <\"}),(0,n.jsx)(e.span,{style:{color:\"#89B4FA\"},children:\"input\"}),(0,n.jsx)(e.span,{style:{color:\"#F9E2AF\"},children:\" name\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#A6E3A1\"},children:'\"content\"'}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\" />\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"  \"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\"  <\"}),(0,n.jsx)(e.span,{style:{color:\"#89B4FA\"},children:\"button\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\">\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"Submit\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\"</\"}),(0,n.jsx)(e.span,{style:{color:\"#89B4FA\"},children:\"button\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\">\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"  \"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\"</\"}),(0,n.jsx)(e.span,{style:{color:\"#89B4FA\"},children:\"form\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\">\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"  \"})]})]})})}),`\n`,(0,n.jsx)(e.p,{children:\"When the client invokes the proxy (e.g., from a button click or a form submission), the browser submits a POST request with the action ID and serialized headers, the whole process is as follows:\"}),`\n`,(0,n.jsx)(\"br\",{}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"1. Serialization of function's arguments\"}),\":\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"FormData is encoded using \",(0,n.jsx)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/API/FormData\",children:(0,n.jsx)(e.code,{children:\"multipart/form-data\"})})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Non-form invocations use JSON.stringify() with \",(0,n.jsx)(e.a,{href:\"https://github.com/blitz-js/superjson\",children:\"SuperJSON\"}),\" for rich type support\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"2. Request Dispatch\"}),`:\nThe proxy sends a POST request to a hidden endpoint with the action ID and serialized parameters.`]}),`\n`,(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{style:{backgroundColor:\"#1e1e2e\",color:\"#cdd6f4\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"catppuccin-mocha\",children:(0,n.jsxs)(e.code,{\"data-language\":\"bash\",\"data-theme\":\"catppuccin-mocha\",style:{display:\"grid\"},children:[(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#89B4FA\",fontStyle:\"italic\"},children:\"POST\"}),(0,n.jsx)(e.span,{style:{color:\"#A6E3A1\"},children:\" /createPost\"}),(0,n.jsx)(e.span,{style:{color:\"#A6E3A1\"},children:\" HTTP/1.1\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"  \"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#89B4FA\",fontStyle:\"italic\"},children:\"Content-Type:\"}),(0,n.jsx)(e.span,{style:{color:\"#A6E3A1\"},children:\" multipart/form-data\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"  \"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#89B4FA\",fontStyle:\"italic\"},children:\"X-Action:\"}),(0,n.jsx)(e.span,{style:{color:\"#A6E3A1\"},children:' \"ACTION_ID\"'}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"  \"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#89B4FA\",fontStyle:\"italic\"},children:\"X-Forwarded-Host:\"}),(0,n.jsx)(e.span,{style:{color:\"#A6E3A1\"},children:\" example.com\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"  \"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#F38BA8\",fontStyle:\"italic\"},children:\"...\"})})]})})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"3. Server Processing\"}),\": The server intercepts the request, and:\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Next.js runtime (or the server proxy) matches the \",(0,n.jsx)(e.code,{children:\"X-Action\"}),\" header to registered functions.\"]}),`\n`,(0,n.jsx)(e.li,{children:\"Deserializes payload using inverse of client-side encoding.\"}),`\n`,(0,n.jsx)(e.li,{children:\"Executes within isolated server context (no client dependencies).\"}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"4. Response Handling\"}),\":\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"The output is serialized and returned to the client.\"}),`\n`,(0,n.jsx)(e.li,{children:\"The client proxy receives the response and continues execution as if it were a direct function call.\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"This remote procedure call (RPC) pattern means that\\u2014despite the illusion of a direct function call\\u2014every server action is performing a network round-trip over HTTP behind the scenes. The beauty of this abstraction is that it eliminates the need to manually create and maintain separate API endpoints for many common operations.\"}),`\n`,(0,n.jsxs)(e.h3,{id:\"security-architecture\",children:[(0,n.jsx)(e.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#security-architecture\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Security Architecture\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Server Actions implement enterprise-grade security by default:\"}),`\n`,(0,n.jsxs)(e.h4,{id:\"csrf-protection\",children:[(0,n.jsx)(e.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#csrf-protection\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"CSRF Protection\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Automatic CSRF tokens\"}),\": Each server action request includes a unique \",(0,n.jsx)(e.a,{href:\"https://brightsec.com/blog/csrf-token/\",children:\"CSRF token\"}),\" in the headers.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Signed double-submit cookies with \",(0,n.jsx)(e.code,{children:\"__Host-\"}),\" prefix\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Strict origin matching via \",(0,n.jsx)(e.code,{children:\"Sec-Fetch-Site\"}),\" header validation\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.h4,{id:\"payload-validation\",children:[(0,n.jsx)(e.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#payload-validation\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Payload Validation\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Type safety\"}),\": TypeScript types are enforced on the server side.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{style:{backgroundColor:\"#1e1e2e\",color:\"#cdd6f4\"},tabIndex:\"0\",\"data-language\":\"ts\",\"data-theme\":\"catppuccin-mocha\",children:(0,n.jsxs)(e.code,{\"data-language\":\"ts\",\"data-theme\":\"catppuccin-mocha\",style:{display:\"grid\"},children:[(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#6C7086\",fontStyle:\"italic\"},children:\"// Next.js generates runtime validation from TypeScript types:  \"})}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\"if\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\" (\"}),(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\"typeof\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\" data\"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"content \"}),(0,n.jsx)(e.span,{style:{color:\"#94E2D5\"},children:\"!==\"}),(0,n.jsx)(e.span,{style:{color:\"#A6E3A1\"},children:' \"string\"'}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\") \"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\"{\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"  \"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\"},children:\"  throw\"}),(0,n.jsx)(e.span,{style:{color:\"#CBA6F7\",fontWeight:\"bold\"},children:\" new\"}),(0,n.jsx)(e.span,{style:{color:\"#89B4FA\",fontStyle:\"italic\"},children:\" ActionError\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#A6E3A1\"},children:'\"Invalid payload\"'}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\")\"}),(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\";\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"  \"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#9399B2\"},children:\"}\"}),(0,n.jsx)(e.span,{style:{color:\"#CDD6F4\"},children:\"  \"})]})]})})}),`\n`,(0,n.jsxs)(r,{icon:(0,n.jsx)(t.InfoIcon,{}),type:\"danger\",children:[(0,n.jsxs)(e.h4,{id:\"no-runtime-type-safety\",children:[(0,n.jsx)(e.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#no-runtime-type-safety\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"No runtime type safety\"]}),(0,n.jsxs)(e.p,{children:[\"Always validate server action inputs with \",(0,n.jsx)(e.a,{href:\"https://zod.dev/\",children:(0,n.jsx)(e.code,{children:\"Zod\"})}),\", as TypeScript types alone don\\u2019t provide runtime safety.\"]})]}),`\n`,(0,n.jsxs)(e.h4,{id:\"isolation-boundaries\",children:[(0,n.jsx)(e.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#isolation-boundaries\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Isolation Boundaries\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Server-side isolation\"}),\": Server actions run in a separate Node.js process, isolated from the client runtime.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Timeouts enforced via \",(0,n.jsx)(e.a,{href:\"https://nodejs.org/api/async_context.html\",children:(0,n.jsx)(e.code,{children:\"AsyncLocalStorage\"})}),\".\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.h3,{id:\"conclusion\",children:[(0,n.jsx)(e.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#conclusion\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Conclusion\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Server Actions represent a fundamental shift in web architecture, enabling developers to build full-stack applications with minimal boilerplate. By abstracting away the complexities of network communication and security.\"})]})}function p(l={}){let{wrapper:e}=l.components||{};return e?(0,n.jsx)(e,{...l,children:(0,n.jsx)(h,{...l})}):h(l)}function o(l,e){throw new Error(\"Expected \"+(e?\"component\":\"object\")+\" `\"+l+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return C(b);})();\n;return Component;"
    },
    "_id": "blogs/server-actions-under-the-hood.mdx",
    "_raw": {
      "sourceFilePath": "blogs/server-actions-under-the-hood.mdx",
      "sourceFileName": "server-actions-under-the-hood.mdx",
      "sourceFileDir": "blogs",
      "contentType": "mdx",
      "flattenedPath": "blogs/server-actions-under-the-hood"
    },
    "type": "Doc",
    "slug": "/blogs/server-actions-under-the-hood",
    "slugAsParams": "server-actions-under-the-hood"
  }
]